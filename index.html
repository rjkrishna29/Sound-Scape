<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Synth</title>
    <link rel="stylesheet" href="style.css"> <!-- External CSS file -->
</head>
<body>

<!-- ===================== WELCOME PAGE ===================== -->
<div class="welcome-page-home" id="welcomePage">
    <div class="welcome-page">
        <div class="welcome-text">
            <h1>Welcome to Synth</h1>
            <p>Upload your music collection and experience studio-quality playback</p>
        </div>

        <!-- Upload section for individual files and entire folder -->
        <div class="upload-section">

            <!-- Upload individual files -->
            <div class="upload-container">
                <input type="file" id="fileInput" multiple accept="audio/*" hidden>
                <label class="upload-label" for="fileInput">
                    <div class="upload-icon">üéµ</div>
                    <div style="color: bisque;">Click to upload individual files</div>
                </label>
            </div>

            <!-- Upload entire folder -->
            <div class="upload-container">
                <input type="file" id="folderInput" webkitdirectory directory multiple hidden>
                <label class="upload-label" for="folderInput">
                    <div class="upload-icon">üìÅ</div>
                    <div style="color: bisque;">Click to upload an entire folder</div>
                </label>
            </div>
        </div>

        <div style="color: #666; font-size: 0.9rem; margin-top: 20px;">
            Supports MP3, WAV, FLAC, and more
        </div>
    </div>
</div>

<!-- ===================== PLAYER PAGE ===================== -->
<div class="player-page" id="playerPage" style="display: none;">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-logo">Synth</div>
        <ul class="nav-links">
            <li><a href="about.html">About</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>
    </nav>

    <!-- Main Player Layout -->
    <div class="player-container">
        <!-- Left Section: Music Player -->
        <div class="player-left">
            <img src="icons/balthazar-disque.gif" alt="Album Art" class="album-art" id="albumArt"/>

            <div class="track-info">
                <h2 id="songTitle">Song Title</h2>
                <p id="songArtist">Artist Name</p> <!-- Correct ID -->
            </div>

            <!-- Seekbar -->
            <div class="seek-bar" id="seekBar">
                <div class="progress" id="progress"></div>
            </div>

            <div id="timeWrapper">
              <span id="currentTime">0:00</span>
              <span id="totalTime">0:00</span>
            </div>

            <!-- Playback Controls -->
            <div class="controls">
                <button id="shuffle">
                  <img id="shuffleIcon" src="icons/shuffle.png" alt="Shuffle" width="32" height="32">
                </button>
                <button id="prevBtn">
                  <img id="prevIcon" src="icons/previous.png" alt="Previous" width="32" height="32">
                </button>
                <button id="playPauseBtn">
                    <img id="playPauseIcon" src="icons/play.png" alt="Play" width="32" height="32">
                </button>
                <!-- Corrected ID -->
                <button id="nextBtn">
                    <img id="nextIcon" src="icons/next.png" alt="Next" width="32" height="32">
                <button id="repeat">
                    <img id="repeatIcon" src="icons/repeatoff.png" alt="Repeat" width="32" height="32">
                </button>
            </div>
        </div>

        <!-- Right Section: Playlist -->
        <div class="playlist-right">
            <h3>Playlist</h3>
            <ul class="playlist" id="playlist">
                <!-- Songs are dynamically appended here -->
            </ul>
        </div>
    </div>
</div>

<!-- ===================== SCRIPT ===================== -->
<script>
    let currentTrackIndex = 0;
    let tracks = [];
    const audio = new Audio();
    let repeatMode = 0; // 0: off, 1: all, 2: one

    // DOM elements
    const welcomePage = document.getElementById('welcomePage');
    const playerPage = document.getElementById('playerPage');
    const fileInput = document.getElementById('fileInput');
    const folderInput = document.getElementById('folderInput');
    const playlist = document.getElementById('playlist');
    const songTitle = document.getElementById('songTitle');
    const songArtist = document.getElementById('songArtist');
    const progress = document.getElementById('progress');
    const seekBar = document.getElementById('seekBar');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playPauseIcon = document.getElementById('playPauseIcon');
    const currentTimeEl = document.getElementById('currentTime');
    const totalTimeEl = document.getElementById('totalTime');
    const repeatBtn = document.getElementById('repeat');
    const repeatIcon = document.getElementById('repeatIcon');
    const shuffleBtn = document.getElementById('shuffle');
    const shuffleIcon = document.getElementById('shuffleIcon');

    // Helper to format seconds into mm:ss
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }


    // Handle file/folder uploads
    function handleUpload(files) {
        // Filter audio files and create track objects
        tracks = Array.from(files).filter(file => file.type.startsWith('audio/')).map(file => ({
            name: file.name.replace(/\.[^/.]+$/, ""), // Remove extension
            url: URL.createObjectURL(file)
        }));

        if (tracks.length === 0) {
            alert("No audio files found.");
            return;
        }

        // Hide welcome page and show player page
        welcomePage.style.display = 'none';
        playerPage.style.display = 'grid';

        // Populate playlist
        playlist.innerHTML = tracks.map((track, index) => `
            <li class="playlist-item ${index === 0 ? 'active' : ''}" data-index="${index}">
                ${track.name}
            </li>
        `).join('');

        // Playlist click events
        document.querySelectorAll('.playlist-item').forEach(item => {
            item.addEventListener('click', () => {
                currentTrackIndex = parseInt(item.dataset.index);
                playTrack(currentTrackIndex);
                updateActiveItem();
            });
        });

        // Play first track
        playTrack(0);
    }

    // Listeners for file and folder uploads
    fileInput.addEventListener('change', e => handleUpload(e.target.files));
    folderInput.addEventListener('change', e => handleUpload(e.target.files));

    // Play selected track
    function playTrack(index) {
        currentTrackIndex = index;
        audio.src = tracks[index].url;
        audio.play();
        playPauseIcon.src = 'icons/pause.png'; // Set to pause icon when playing
        playPauseIcon.alt = 'Pause';
        songTitle.textContent = tracks[index].name;
        songArtist.textContent = "Unknown Artist"; // Placeholder
        updateActiveItem();
    }

    // Highlight current playing track
    function updateActiveItem() {
        document.querySelectorAll('.playlist-item').forEach((item, i) => {
            item.classList.toggle('active', i === currentTrackIndex);
        });
    }

    // Play/pause toggle
    playPauseBtn.addEventListener('click', function () {
    if (audio.paused) {
        audio.play();
        playPauseIcon.src = 'icons/pause.png';
        playPauseIcon.alt = 'Pause';
    } else {
        audio.pause();
        playPauseIcon.src = 'icons/play.png';
        playPauseIcon.alt = 'Play';
    }
});

    // Previous track
    document.getElementById('prevBtn').addEventListener('click', () => {
        currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
        playTrack(currentTrackIndex);
    });

    // Next track
    document.getElementById('nextBtn').addEventListener('click', () => {
        currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
        playTrack(currentTrackIndex);
    });

    // Progress bar update
    audio.addEventListener('timeupdate', () => {
        if (audio.duration) {
            const progressPercent = (audio.currentTime / audio.duration) * 100;
            progress.style.width = `${progressPercent}%`;

            currentTimeEl.textContent = formatTime(audio.currentTime);
            totalTimeEl.textContent = formatTime(audio.duration);
        }
    });


    // Seek on click
    seekBar.addEventListener('click', (e) => {
        const rect = seekBar.getBoundingClientRect();
        const seekTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
        audio.currentTime = seekTime;
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        switch (e.code) {
            case 'Space':
                e.preventDefault();
                playPauseBtn.click();
                break;
            case 'ArrowLeft':
                audio.currentTime -= 5;
                break;
            case 'ArrowRight':
                audio.currentTime += 5;
                break;
        }
    });

    repeatBtn.addEventListener('click', () => {
    repeatMode = (repeatMode + 1) % 3;
    switch (repeatMode) {
        case 0:
            repeatIcon.src = 'icons/repeatoff.png';
            repeatIcon.alt = 'Repeat Off';
            audio.loop = false;
            break;
        case 1:
            repeatIcon.src = 'icons/repeaton.png';
            repeatIcon.alt = 'Repeat All';
            audio.loop = false;
            break;
        case 2:
            repeatIcon.src = 'icons/repeat1.png';
            repeatIcon.alt = 'Repeat One';
            audio.loop = true;
            break;
    }
});

// Shuffle functionality
shuffleBtn.addEventListener('click', () => {
    // Fisher-Yates shuffle
    for (let i = tracks.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [tracks[i], tracks[j]] = [tracks[j], tracks[i]];
    }

    // Re-render playlist
    playlist.innerHTML = tracks.map((track, index) => `
        <li class="playlist-item ${index === 0 ? 'active' : ''}" data-index="${index}">
            ${track.name}
        </li>
    `).join('');

    // Update playlist click events
    document.querySelectorAll('.playlist-item').forEach(item => {
        item.addEventListener('click', () => {
            currentTrackIndex = parseInt(item.dataset.index);
            playTrack(currentTrackIndex);
            updateActiveItem();
        });
    });

    // Play the first song in the shuffled list
    currentTrackIndex = 0;
    playTrack(currentTrackIndex);
});

// Handle what happens when a song ends
audio.addEventListener('ended', () => {
    if (repeatMode === 2) {
        // Repeat one: audio.loop handles this, but for safety:
        audio.currentTime = 0;
        audio.play();
    } else if (repeatMode === 1) {
        // Repeat all: go to next, loop to first if at end
        currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
        playTrack(currentTrackIndex);
    } else {
        // Repeat off: play next if not last, else stop
        if (currentTrackIndex < tracks.length - 1) {
            currentTrackIndex++;
            playTrack(currentTrackIndex);
        }
        // else do nothing (stop)
    }
});

audio.addEventListener('play', () => {
    playPauseIcon.src = 'icons/pause.png';
    playPauseIcon.alt = 'Pause';
});

audio.addEventListener('pause', () => {
    playPauseIcon.src = 'icons/play.png';
    playPauseIcon.alt = 'Play';
});

window.addEventListener('DOMContentLoaded', () => {
    if (window.location.hash === '#playerPage') {
        welcomePage.style.display = 'none';
        playerPage.style.display = 'grid';
    }
});

// Set theme color from localStorage on page load
(function() {
    const saved = localStorage.getItem('synth-theme-color') || '#4ecdc4';
    document.documentElement.style.setProperty('--theme-color', saved);
})();

// function savePlaylist() {
//     localStorage.setItem('synth-playlist', JSON.stringify(tracks));
//     localStorage.setItem('synth-current-index', currentTrackIndex);
// }

// // Restore playlist from localStorage if available
// (function restorePlaylist() {
//     const savedTracks = localStorage.getItem('synth-playlist');
//     const savedIndex = localStorage.getItem('synth-current-index');
//     if (savedTracks) {
//         tracks = JSON.parse(savedTracks);
//         currentTrackIndex = savedIndex ? parseInt(savedIndex) : 0;

//         // Populate playlist UI
//         playlist.innerHTML = tracks.map((track, index) => `
//             <li class="playlist-item ${index === currentTrackIndex ? 'active' : ''}" data-index="${index}">
//                 ${track.name}
//             </li>
//         `).join('');

//         // Add click events
//         document.querySelectorAll('.playlist-item').forEach(item => {
//             item.addEventListener('click', () => {
//                 currentTrackIndex = parseInt(item.dataset.index);
//                 playTrack(currentTrackIndex);
//                 updateActiveItem();
//                 savePlaylist();
//             });
//         });

//         // Show player page if coming from about/settings
//         welcomePage.style.display = 'none';
//         playerPage.style.display = 'grid';

//         // Play current track (or just set up UI)
//         playTrack(currentTrackIndex);
//     }
// })();
</script>

</body>
</html>
